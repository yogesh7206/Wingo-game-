<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Wingo Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; background: #f4f4f4; margin: 0; padding: 10px; max-width: 600px; margin: auto; }
    h2, h3 { margin-top: 20px; }
    input, button, select { padding: 10px; margin: 5px 0; width: 100%; font-size: 16px; }
    nav button { width: 32%; margin: 1%; }
    .hidden { display: none; }
    .game-btns button { width: 23%; margin: 1%; }
    .tab { display: none; }
    .active-tab { display: block; }
    @media(max-width: 480px) {
      h2, h3 { font-size: 18px; }
      input, button { font-size: 14px; }
    }
  </style>
</head>
<body>

<!-- 🔐 LOGIN / REGISTER -->
<div id="authSection">
  <h2>🔐 Login</h2>
  <input type="email" id="loginEmail" placeholder="Email">
  <input type="password" id="loginPass" placeholder="Password">
  <button onclick="login()">Login</button>
  <p>Don't have an account? <a href="#" onclick="toggleAuth()">Register</a></p>

  <div id="registerForm" class="hidden">
    <h2>📝 Register</h2>
    <input type="email" id="registerEmail" placeholder="Email">
    <input type="password" id="registerPass" placeholder="Password">
    <input type="text" id="referralCode" placeholder="Referral ID (optional)">
    <button onclick="register()">Register</button>
    <p>Already have an account? <a href="#" onclick="toggleAuth()">Login</a></p>
  </div>
</div>

<!-- ✅ MAIN APP -->
<div id="mainSection" class="hidden">
  <h2>Welcome, <span id="userId">User</span></h2>
  <p>💰 Balance: ₹<span id="userBalance">0</span></p>

  <!-- 🔄 NAVIGATION -->
  <nav>
    <button onclick="showTab('lotteryTab')">🎮 Lottery</button>
    <button onclick="showTab('walletTab')">💼 Wallet</button>
    <button onclick="showTab('profileTab')">👤 Profile</button>
  </nav>

  <!-- 🎮 LOTTERY MENU -->
  <div id="lotteryTab" class="tab active-tab">
    <h3>🎯 Choose Game</h3>
    <div class="game-btns">
      <button onclick="showGame('wingo')">Wingo</button>
      <button onclick="showGame('parity')">Parity</button>
    </div>

    <!-- WINGO GAME -->
    <div id="wingoGame" class="game-tab">
      <h3>🎯 Wingo Game</h3>
      <p>🕓 Period: <span id="wingoPeriod">--</span></p>
      <p>⏳ Time Left: <span id="wingoTimer">--</span></p>
      <p>
        <button onclick="placeBet('green')">Green</button>
        <button onclick="placeBet('red')">Red</button>
        <button onclick="placeBet('violet')">Violet</button>
      </p>
      <input type="number" id="betAmount" placeholder="Enter amount">
      <button onclick="submitBet()">Submit Bet</button>
      <p>🎯 Last Result: <span id="wingoResult">--</span></p>
    </div>

    <!-- PARITY GAME -->
    <div id="parityGame" class="game-tab hidden">
      <h3>🟢 Parity Game</h3>
      <p>🕓 Period: <span id="parityPeriod">--</span></p>
      <p>⏳ Time Left: <span id="parityTimer">--</span></p>
      <p>
        <button onclick="placeParity('even')">Even</button>
        <button onclick="placeParity('odd')">Odd</button>
      </p>
      <input type="number" id="parityAmount" placeholder="Enter amount">
      <button onclick="submitParity()">Submit Bet</button>
      <p>🎯 Last Result: <span id="parityResult">--</span> (Number: <span id="parityNumber">--</span>)</p>
    </div>
  </div>
  <!-- 💼 WALLET -->
  <div id="walletTab" class="tab hidden">
    <h3>💳 Wallet</h3>
    <input type="number" id="depositAmount" placeholder="Deposit amount">
    <button onclick="requestDeposit()">Request Deposit</button>
    <input type="number" id="withdrawAmount" placeholder="Withdraw amount">
    <button onclick="requestWithdraw()">Request Withdraw</button>
    <p>Deposit & Withdraw needs admin approval.</p>
  </div>

  <!-- 👤 PROFILE -->
  <div id="profileTab" class="tab hidden">
    <h3>👤 Profile</h3>
    <p>📌 Your UID: <span id="userUID"></span></p>
    <p>🎁 Your Referral Code: <b><span id="myRefCode"></span></b></p>
    <p>📨 Referral Link:</p>
    <input id="refLink" readonly>
    <button onclick="copyRef()">Copy</button>
    <h3>📜 Bet History</h3>
    <div id="betHistory">Loading...</div>
  </div>

  <!-- 🛠️ ADMIN PANEL -->
  <div id="adminPanel" class="hidden">
    <h3>🛠️ Admin Controls</h3>
    <button onclick="loadDashboard()">📊 Load Dashboard</button>
    <div id="dashboardStats"></div>

    <h4>✅ Approve Deposits</h4>
    <div id="depositRequests">Loading...</div>

    <h4>✅ Approve Withdrawals</h4>
    <div id="withdrawRequests">Loading...</div>

    <h4>🏆 Top Winners</h4>
    <div id="leaderboard">Loading...</div>

    <button onclick="autoResult()">⏱️ Start Auto Result Generator</button>
  </div>
</div>

<!-- 🔊 SOUND -->
<audio id="resultSound" src="https://www.soundjay.com/button/beep-07.mp3"></audio>
<!-- 🔥 Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<script>
  // ✅ Firebase Config
  const firebaseConfig = {
  apiKey: "AIzaSyBe5kGOwYS3FsF_9_q1pjxaWrF1glUe87c",
  authDomain: "wingologin.firebaseapp.com",
  databaseURL: "https://wingologin-default-rtdb.firebaseio.com",
  projectId: "wingologin",
  storageBucket: "wingologin.firebasestorage.app",
  messagingSenderId: "605536859710",
  appId: "1:605536859710:web:ed9495775c8f8dd6a8836f",
  measurementId: "G-FLDY936H9P"
};
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // 🔐 Login/Register Logic
  function toggleAuth() {
    document.getElementById('registerForm').classList.toggle('hidden');
  }

  function login() {
    const email = loginEmail.value;
    const pass = loginPass.value;
    auth.signInWithEmailAndPassword(email, pass).then(user => {
      initApp();
    }).catch(e => alert(e.message));
  }

  function register() {
    const email = registerEmail.value;
    const pass = registerPass.value;
    const ref = referralCode.value;
    auth.createUserWithEmailAndPassword(email, pass).then(cred => {
      const uid = cred.user.uid;
      db.collection('users').doc(uid).set({
        email, balance: 0, referral: ref || '', uid
      });
      if (ref) {
        db.collection("users").where("uid", "==", ref).get().then(snap => {
          if (!snap.empty) {
            let refUser = snap.docs[0].ref;
            refUser.update({ balance: firebase.firestore.FieldValue.increment(6) });
          }
        });
      }
    }).catch(e => alert(e.message));
  }

  auth.onAuthStateChanged(user => {
    if (user) initApp();
  });

  // 🌐 UI Init
  function initApp() {
    authSection.classList.add('hidden');
    mainSection.classList.remove('hidden');
    userId.textContent = auth.currentUser.email;
    userUID.textContent = auth.currentUser.uid;
    db.collection('users').doc(auth.currentUser.uid).onSnapshot(doc => {
      const data = doc.data();
      userBalance.textContent = data.balance;
      myRefCode.textContent = data.uid;
      refLink.value = `${location.href.split('#')[0]}?ref=${data.uid}`;
    });
    loadHistory();
    checkAdmin();
    startTimer();
  }

  function copyRef() {
    refLink.select();
    document.execCommand("copy");
    alert("Referral link copied!");
  }

  // 🧭 Tab Navigation
  function showTab(tabId) {
    document.querySelectorAll('.tab').forEach(t => t.classList.add('hidden'));
    document.getElementById(tabId).classList.remove('hidden');
  }

  function showGame(game) {
    document.querySelectorAll('.game-tab').forEach(g => g.classList.add('hidden'));
    document.getElementById(game + "Game").classList.remove('hidden');
  }

  // 💼 Wallet Functions
  function requestDeposit() {
    const amt = parseInt(depositAmount.value);
    if (amt > 0) {
      db.collection("requests").add({
        uid: auth.currentUser.uid,
        amount: amt,
        type: "deposit",
        status: "pending"
      });
      alert("Deposit requested!");
    }
  }

  function requestWithdraw() {
    const amt = parseInt(withdrawAmount.value);
    if (amt > 0) {
      db.collection("requests").add({
        uid: auth.currentUser.uid,
        amount: amt,
        type: "withdraw",
        status: "pending"
      });
      alert("Withdraw requested!");
    }
  }

  // 🕒 Shared Timer / Period
  let currentPeriod = '';
  function startTimer() {
    setInterval(() => {
      const now = new Date();
      const sec = now.getSeconds();
      const remaining = 60 - sec;
      const period = now.getHours().toString().padStart(2, '0') + 
                     now.getMinutes().toString().padStart(2, '0');
      document.getElementById('wingoTimer').textContent = remaining + 's';
      document.getElementById('parityTimer').textContent = remaining + 's';
      document.getElementById('wingoPeriod').textContent = period;
      document.getElementById('parityPeriod').textContent = period;
      currentPeriod = period;
    }, 1000);
  }

  // 🎮 Place Bets
  function placeBet(color) {
    sessionStorage.setItem("wingoBet", color);
    alert("Selected: " + color);
  }

  function submitBet() {
    const amt = parseInt(betAmount.value);
    const color = sessionStorage.getItem("wingoBet");
    if (!color || amt <= 0) return alert("Select color and enter amount");
    db.collection("bets").add({
      uid: auth.currentUser.uid,
      amount: amt,
      color, period: currentPeriod,
      time: Date.now()
    });
    alert("Bet placed!");
  }

  function placeParity(choice) {
    sessionStorage.setItem("parityChoice", choice);
    alert("Selected: " + choice);
  }

  function submitParity() {
    const amt = parseInt(parityAmount.value);
    const choice = sessionStorage.getItem("parityChoice");
    if (!choice || amt <= 0) return alert("Select choice and enter amount");
    db.collection("parityBets").add({
      uid: auth.currentUser.uid,
      amount: amt,
      choice, period: currentPeriod,
      time: Date.now()
    });
    alert("Bet placed!");
  }

  // 📜 Bet History
  function loadHistory() {
    const uid = auth.currentUser.uid;
    let html = '';
    db.collection("bets").where("uid", "==", uid).limit(10).get().then(snap => {
      snap.forEach(doc => {
        const d = doc.data();
        html += `<p>Wingo [${d.period}] - ₹${d.amount} on ${d.color}</p>`;
      });
      db.collection("parityBets").where("uid", "==", uid).limit(10).get().then(snap2 => {
        snap2.forEach(doc => {
          const d = doc.data();
          html += `<p>Parity [${d.period}] - ₹${d.amount} on ${d.choice}</p>`;
        });
        document.getElementById("betHistory").innerHTML = html;
      });
    });
  }

  // 🧠 Admin Panel
  function checkAdmin() {
    const uid = auth.currentUser.uid;
    if (uid === "ADMIN_UID_HERE") {
      document.getElementById("adminPanel").classList.remove("hidden");
    }
  }

  // 🏆 Leaderboard
  function loadLeaderboard() {
    db.collection("bets").get().then(snap => {
      const winMap = {};
      snap.forEach(doc => {
        const d = doc.data();
        if (!winMap[d.uid]) winMap[d.uid] = 0;
        winMap[d.uid] += d.amount;
      });
      const sorted = Object.entries(winMap).sort((a,b) => b[1]-a[1]).slice(0,5);
      let html = '';
      sorted.forEach(([uid, amt]) => {
        html += `<p>${uid} - ₹${amt}</p>`;
      });
      leaderboard.innerHTML = html;
    });
  }

  // 📊 Dashboard
  function loadDashboard() {
    db.collection("users").get().then(snap => {
      let totalUsers = snap.size;
      db.collection("bets").get().then(bets => {
        db.collection("parityBets").get().then(pbets => {
          db.collection("requests").get().then(reqs => {
            let totalDeposit = 0, totalWithdraw = 0;
            reqs.forEach(r => {
              let d = r.data();
              if (d.status === "approved") {
                if (d.type === "deposit") totalDeposit += d.amount;
                else if (d.type === "withdraw") totalWithdraw += d.amount;
              }
            });
            dashboardStats.innerHTML = `
              <p>Users: ${totalUsers}</p>
              <p>Wingo Bets: ${bets.size}</p>
              <p>Parity Bets: ${pbets.size}</p>
              <p>Total Deposits: ₹${totalDeposit}</p>
              <p>Total Withdrawals: ₹${totalWithdraw}</p>
            `;
          });
        });
      });
    });
  }

  // 🔁 Auto Result Generator
  function autoResult() {
    setInterval(() => {
      const colors = ['green','red','violet'];
      const rand = colors[Math.floor(Math.random()*3)];
      const result = document.getElementById("wingoResult");
      result.textContent = rand;
      document.getElementById("resultSound").play();
    }, 60000);
  }
</script>
</body>
</html>
