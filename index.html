<!DOCTYPE html>
<html>
<head>
  <title>Wingo Game</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial, sans-serif; background: #f0f0f0; margin: 0; }
    nav { background: #333; color: #fff; padding: 10px; display: flex; justify-content: space-around; }
    nav button { background: none; border: none; color: #fff; font-size: 16px; cursor: pointer; }
    .section { display: none; padding: 20px; }
    .active { display: block; }
    .game-buttons button { margin: 5px; padding: 10px; }
  </style>
</head>
<body>

<nav>
  <button onclick="showSection('loginSection')">Login</button>
  <button onclick="showSection('registerSection')">Register</button>
  <button onclick="showSection('homeSection')">Home</button>
  <button onclick="showSection('walletSection')">Wallet</button>
  <button onclick="showSection('lotterySection')">Game</button>
</nav>

<!-- Login Section -->
<div id="loginSection" class="section active">
  <h2>Login</h2>
  <input type="email" id="loginEmail" placeholder="Email"><br><br>
  <input type="password" id="loginPassword" placeholder="Password"><br><br>
  <button onclick="login()">Login</button>
  <p>Don't have an account? <button onclick="showSection('registerSection')">Register</button></p>
</div>

<!-- Register Section -->
<div id="registerSection" class="section">
  <h2>Register</h2>
  <input type="email" id="registerEmail" placeholder="Email"><br><br>
  <input type="password" id="registerPassword" placeholder="Password"><br><br>
  <input type="text" id="referralCode" placeholder="Referral Code (optional)"><br><br>
  <button onclick="register()">Register</button>
  <p>Already have an account? <button onclick="showSection('loginSection')">Login</button></p>
</div>

<!-- Home Section -->
<div id="homeSection" class="section">
  <h2>Welcome, <span id="userEmail">User</span></h2>
  <p>User ID: <span id="userId">--</span></p>
</div>
<!-- Wallet Section -->
<div id="walletSection" class="section">
  <h2>Your Wallet</h2>
  <p>Balance: ‚Çπ<span id="walletBalance">0</span></p>
</div>

<!-- Lottery Section -->
<div id="lotterySection" class="section">
  <h2>üéÆ Lottery Games</h2>
  <button onclick="showGame('wingo')">Wingo</button>
  <button onclick="showGame('parity')">Parity</button>

  <div id="wingoGame" class="gameSection">
    <h3>üéØ Wingo Game</h3>
    <p>Balance: ‚Çπ<span id="wingoBalance">0</span></p>
    <p>Period: <span id="wingoPeriod">--</span></p>
    <p>‚è≥ Time Left: <span id="wingoTimer">--</span></p>
    <div class="game-buttons" id="wingoButtons"></div>
  </div>

  <div id="parityGame" class="gameSection" style="display:none;">
    <h3>üéØ Parity Game</h3>
    <p>Balance: ‚Çπ<span id="parityBalance">0</span></p>
    <p>Period: <span id="parityPeriod">--</span></p>
    <p>‚è≥ Time Left: <span id="parityTimer">--</span></p>
    <div class="game-buttons" id="parityButtons"></div>
  </div>
</div>
<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
  // ‚úÖ Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBe5kGOwYS3FsF_9_q1pjxaWrF1glUe87c",
    authDomain: "wingologin.firebaseapp.com",
    databaseURL: "https://wingologin-default-rtdb.firebaseio.com",
    projectId: "wingologin",
    storageBucket: "wingologin.appspot.com",
    messagingSenderId: "605536859710",
    appId: "1:605536859710:web:ed9495775c8f8dd6a8836f"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  let currentUser = null;

  function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function showGame(game) {
    document.getElementById("wingoGame").style.display = game === "wingo" ? "block" : "none";
    document.getElementById("parityGame").style.display = game === "parity" ? "block" : "none";
  }

  function register() {
    const email = document.getElementById("registerEmail").value;
    const password = document.getElementById("registerPassword").value;
    const referral = document.getElementById("referralCode").value;

    auth.createUserWithEmailAndPassword(email, password).then(userCredential => {
      const uid = userCredential.user.uid;
      db.ref("users/" + uid).set({
        email: email,
        balance: 100,
        referral: referral || ""
      });
      alert("Registered! Now login.");
      showSection('loginSection');
    }).catch(error => alert(error.message));
  }

  function login() {
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPassword").value;

    auth.signInWithEmailAndPassword(email, password).then(userCredential => {
      currentUser = userCredential.user;
      loadUserData(currentUser.uid);
      showSection('homeSection');
    }).catch(error => alert(error.message));
  }

  function loadUserData(uid) {
    db.ref("users/" + uid).once("value").then(snapshot => {
      const data = snapshot.val();
      document.getElementById("userEmail").innerText = data.email;
      document.getElementById("userId").innerText = uid;
      document.getElementById("walletBalance").innerText = data.balance;
      document.getElementById("wingoBalance").innerText = data.balance;
      document.getElementById("parityBalance").innerText = data.balance;
    });
  }

  // Game Buttons
  const numbers = [2, 3, 5, 7];
  window.onload = () => {
    numbers.forEach(num => {
      document.getElementById("wingoButtons").innerHTML += `<button onclick="placeBet('wingo', ${num})">${num}</button>`;
      document.getElementById("parityButtons").innerHTML += `<button onclick="placeBet('parity', ${num})">${num}</button>`;
    });
    startTimerLoop();
  };

  function placeBet(game, number) {
    if (!currentUser) return alert("Login first");
    const uid = currentUser.uid;
    const ref = db.ref("users/" + uid);
    ref.once("value").then(snapshot => {
      let balance = snapshot.val().balance;
      if (balance < 10) return alert("Insufficient balance");
      balance -= 10;
      ref.update({ balance });
      db.ref("bets/" + game + "/" + currentPeriod + "/" + uid).push({ number, time: Date.now() });
      loadUserData(uid);
      alert("Bet placed on " + number);
    });
  }

  // Shared Timer & Period
  let currentPeriod = "--";
  let timeLeft = 0;

  function startTimerLoop() {
    const periodRef = db.ref("game/period");
    const timeRef = db.ref("game/time");

    periodRef.on("value", snap => {
      currentPeriod = snap.val();
      document.getElementById("wingoPeriod").innerText = currentPeriod;
      document.getElementById("parityPeriod").innerText = currentPeriod;
    });

    timeRef.on("value", snap => {
      timeLeft = snap.val();
    });

    setInterval(() => {
      if (timeLeft > 0) {
        timeLeft--;
        db.ref("game/time").set(timeLeft);
      } else {
        timeLeft = 60;
        db.ref("game/period").transaction(n => (parseInt(n || "1000") + 1).toString());
      }
      document.getElementById("wingoTimer").innerText = timeLeft + "s";
      document.getElementById("parityTimer").innerText = timeLeft + "s";
    }, 1000);
  }
</script>
<style>
  body { font-family: Arial; padding: 20px; }
  .section { display: none; }
  .section.active { display: block; }
  .gameSection { margin-top: 15px; }
  .game-buttons button { margin: 5px; padding: 10px; }
</style>

<script>
  // Default to login
  showSection('loginSection');
</script>

</body>
</html>
