<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Win89 Casino Demo — Part 3 (Games & Timer)</title>
  <style>
    :root{--bg:#071022;--card:#0f1724;--accent:#ff9800;--muted:#9aa4b2;color:#eaf2ff}
    body{margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,#051226,#081428);color:var(--muted)}
    header{background:rgba(255,255,255,0.02);padding:12px 18px;display:flex;justify-content:space-between;align-items:center}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,#ffb86b,#6ee7b7);display:flex;align-items:center;justify-content:center;font-weight:800;color:#042027}
    nav{display:flex;gap:8px;align-items:center}
    .btn{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px 12px;border-radius:8px;color:var(--muted);cursor:pointer}
    .btn-primary{background:var(--accent);color:#041017;border:0}
    main{max-width:1100px;margin:18px auto;padding:18px;display:grid;grid-template-columns:1fr 360px;gap:16px}
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.6)}
    .hidden{display:none}
    input,select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit;margin-top:8px}
    .bets{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .bet-option{padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);cursor:pointer}
    .bet-option.selected{outline:2px solid rgba(255,255,255,0.06);box-shadow:0 4px 12px rgba(0,0,0,0.4)}
    .small{font-size:13px;color:var(--muted)}
    footer{max-width:1100px;margin:8px auto;color:#8f9aa6;font-size:13px}
    .list{max-height:260px;overflow:auto;margin-top:8px;display:flex;flex-direction:column;gap:8px}
    @media(max-width:980px){main{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">W89</div>
      <div>
        <div style="font-weight:700;color:#e6f5ff">Win89 Demo — Games</div>
        <div class="small">Play-money demo — no real payments</div>
      </div>
    </div>

    <nav>
      <button class="btn" onclick="showSection('login')">Login</button>
      <button class="btn" onclick="showSection('wallet')">Wallet</button>
      <button class="btn" onclick="showSection('lottery')">Lottery</button>
      <button class="btn" onclick="showSection('history')">History</button>
      <button class="btn" onclick="showSection('leaderboard')">Leaderboard</button>
      <button id="btnSignOut" class="btn hidden" onclick="logout()">Logout</button>
      <div id="userBadge" style="margin-left:12px;color:var(--muted)">Not signed in</div>
    </nav>
  </header>

  <main>
    <section class="card">
      <!-- Top: Period & Timer -->
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="small">Period</div>
          <div id="periodNumber" style="font-size:22px;font-weight:700">—</div>
        </div>
        <div style="text-align:center">
          <div class="small">Time left</div>
          <div id="countdown" style="font-size:28px;font-weight:800">--:--</div>
          <div class="small" style="margin-top:6px">Last result: <span id="lastResult">—</span></div>
        </div>
        <div style="text-align:right">
          <div class="small">Round duration (sec)</div>
          <input id="roundDuration" value="30" style="width:86px"/>
        </div>
      </div>

      <!-- Tabs -->
      <div style="margin-top:12px;display:flex;gap:8px">
        <button class="btn tab active" data-section="game" onclick="switchTab('game')">Game</button>
        <button class="btn tab" data-section="history" onclick="switchTab('history')">My Bets</button>
        <button class="btn tab" data-section="leaderboard" onclick="switchTab('leaderboard')">Leaderboard</button>
        <button class="btn tab" data-section="admin" onclick="switchTab('admin')">Admin</button>
      </div>

      <!-- Sections -->
      <div id="section-game" style="margin-top:12px">
        <div style="display:flex;gap:12px;flex-wrap:wrap">
          <!-- Left: Wingo + Parity -->
          <div style="flex:1;min-width:260px">
            <div class="card">
              <div style="font-weight:700">Wingo — Color Prediction</div>
              <div class="small">Pick a color. Payout: x4</div>
              <div class="bets" id="wingoOptions" style="margin-top:10px">
                <div class="bet-option" data-bet="red" data-mult="4">Red</div>
                <div class="bet-option" data-bet="green" data-mult="4">Green</div>
                <div class="bet-option" data-bet="blue" data-mult="4">Blue</div>
                <div class="bet-option" data-bet="yellow" data-mult="4">Yellow</div>
              </div>
            </div>

            <div class="card" style="margin-top:10px">
              <div style="font-weight:700">Place Bet</div>
              <div class="small">Selected: <span id="selectedText">—</span></div>
              <input id="betAmount" value="10" />
              <div style="display:flex;gap:8px;margin-top:8px">
                <button id="placeBetBtn" class="btn-primary btn">Place Bet</button>
                <button id="btnAutoRepeat" class="btn">Auto: Off</button>
              </div>
            </div>
          </div>

          <!-- Right: Parity + Controls -->
          <div style="width:320px;min-width:240px">
            <div class="card">
              <div style="font-weight:700">Parity — Odd / Even</div>
              <div class="small">Payout: x2</div>
              <div class="bets" id="parityOptions" style="margin-top:10px">
                <div class="bet-option" data-bet="odd" data-mult="2">Odd</div>
                <div class="bet-option" data-bet="even" data-mult="2">Even</div>
              </div>
            </div>

            <div class="card" style="margin-top:10px">
              <div style="font-weight:700">Quick Controls</div>
              <div style="display:flex;gap:8px;margin-top:8px">
                <button id="btnDemoDeposit" class="btn">Deposit +1000 (demo)</button>
                <button id="btnClearLocal" class="btn">Clear Local Bets</button>
              </div>
              <div style="margin-top:8px" class="small">Referral: <span id="refLink">—</span></div>
            </div>
          </div>
        </div>
      </div>

      <div id="section-history" class="hidden" style="margin-top:12px">
        <div class="card">
          <div style="font-weight:700">My Bet History</div>
          <div id="betHistoryList" class="list"></div>
        </div>
      </div>

      <div id="section-leaderboard" class="hidden" style="margin-top:12px">
        <div class="card">
          <div style="font-weight:700">Leaderboard</div>
          <div id="leaderboardList" class="list"></div>
        </div>
      </div>

      <div id="section-admin" class="hidden" style="margin-top:12px">
        <div class="card">
          <div style="font-weight:700">Admin (demo)</div>
          <div class="small">Make admin with secret 'admin-secret' (demo only)</div>
          <input id="adminCode" placeholder="admin-secret" />
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="btnMakeAdmin" class="btn">Make Admin</button>
            <button id="btnNextRound" class="btn">Next Round Now</button>
          </div>

          <div style="margin-top:8px" class="small">Force result:</div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <select id="forceType"><option value="color">Color</option><option value="number">Number</option></select>
            <input id="forceValue" placeholder="e.g. red or 7" />
            <button id="btnForce" class="btn">Force</button>
          </div>
        </div>
      </div>

    </section>

    <!-- Right column: Wallet / Recent rounds / Auth -->
    <aside>
      <div class="card">
        <div style="font-weight:700">Wallet & Account</div>
        <div class="small" style="margin-top:8px">Balance: <span id="balanceSidebar">—</span></div>
        <div style="margin-top:8px">
          <div class="small">Withdraw (demo)</div>
          <input id="withdrawAmount" placeholder="Amount" />
          <div style="margin-top:8px"><button id="btnWithdraw" class="btn">Withdraw (demo)</button></div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <div style="font-weight:700">Recent rounds</div>
        <div id="recentRounds" class="list"></div>
      </div>

      <div class="card" style="margin-top:12px">
        <div style="font-weight:700">Authentication</div>
        <div id="authArea" style="margin-top:8px">
          <input id="authEmail" placeholder="Email" />
          <input id="authPassword" type="password" placeholder="Password" style="margin-top:6px" />
          <div style="display:flex;gap:6px;margin-top:8px">
            <button id="btnSignUp" class="btn">Register</button>
            <button id="btnSignIn" class="btn">Login</button>
          </div>
          <div style="margin-top:8px" class="small">Or use the top nav to login/register</div>
        </div>
      </div>
    </aside>
  </main>

  <footer class="small">Demo app — do not use for real-money gambling. Configure your Firebase Realtime DB rules for authenticated use.</footer>

  <!-- Firebase v8 (compat) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <script>
  /********** FIREBASE CONFIG (your config inserted) **********/
  const firebaseConfig = {
    apiKey: "AIzaSyBe5kGOwYS3FsF_9_q1pjxaWrF1glUe87c",
    authDomain: "wingologin.firebaseapp.com",
    databaseURL: "https://wingologin-default-rtdb.firebaseio.com",
    projectId: "wingologin",
    storageBucket: "wingologin.firebasestorage.app",
    messagingSenderId: "605536859710",
    appId: "1:605536859710:web:ed9495775c8f8dd6a8836f",
    measurementId: "G-FLDY936H9P"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  /********** App state **********/
  const state = {
    user: null,
    balance: 0,
    period: 1,
    roundDuration: 30,
    timeLeft: 30,
    selectedBet: null,
    autoRepeat: false
  };

  /********** Helpers **********/
  function fmtTime(sec){
    if(sec < 0) sec = 0;
    const s = Math.floor(sec % 60).toString().padStart(2,'0');
    const m = Math.floor(sec / 60).toString().padStart(2,'0');
    return `${m}:${s}`;
  }

  function switchTab(section){
    document.getElementById('section-game').classList.toggle('hidden', section !== 'game');
    document.getElementById('section-history').classList.toggle('hidden', section !== 'history');
    document.getElementById('section-leaderboard').classList.toggle('hidden', section !== 'leaderboard');
    document.getElementById('section-admin').classList.toggle('hidden', section !== 'admin');
  }

  function showSection(name){
    // map top nav to main behaviors
    if(name === 'wallet') {
      // open wallet area by focusing balance probably
      switchTab('game');
      window.scrollTo({top:400, behavior:'smooth'});
    } else {
      // simple: show login area or others - left column manages it
      // We'll just set focus on auth if login
      if(name === 'login') document.getElementById('authEmail').focus();
    }
  }

  /********** Auth: Register/Login/Logout **********/
  document.getElementById('btnSignUp').addEventListener('click', async ()=>{
    const email = document.getElementById('authEmail').value.trim();
    const pw = document.getElementById('authPassword').value;
    if(!email || !pw){ alert('Enter email and password'); return; }
    try {
      const cred = await auth.createUserWithEmailAndPassword(email, pw);
      const uid = cred.user.uid;
      // create user record with demo balance (also credit referral if present)
      const defaultBal = 1000;
      await db.ref('users/' + uid).set({ email, balance: defaultBal, createdAt: Date.now() });
      // referral credit
      const ref = localStorage.getItem('wingo_ref');
      if(ref){
        const bonus = 50;
        // credit referrer
        const refSnap = await db.ref('users/' + ref).once('value');
        if(refSnap.exists()){
          const prev = Number(refSnap.val().balance || 0);
          await db.ref('users/' + ref + '/balance').set(prev + bonus);
          await db.ref('referrals/' + uid).set({ refBy: ref, at: Date.now() });
        }
        // credit new user
        const thisSnap = await db.ref('users/' + uid + '/balance').once('value');
        const cur = Number(thisSnap.val() || 0);
        await db.ref('users/' + uid + '/balance').set(cur + bonus);
        localStorage.removeItem('wingo_ref');
      }
      alert('Registered. Demo balance added.');
      document.getElementById('authEmail').value = '';
      document.getElementById('authPassword').value = '';
    } catch (err){
      alert(err.message);
    }
  });

  document.getElementById('btnSignIn').addEventListener('click', async ()=>{
    const email = document.getElementById('authEmail').value.trim();
    const pw = document.getElementById('authPassword').value;
    if(!email || !pw){ alert('Enter email and password'); return; }
    try {
      await auth.signInWithEmailAndPassword(email, pw);
    } catch (err){
      alert(err.message);
    }
  });

  function logout(){ auth.signOut(); }

  auth.onAuthStateChanged(async (user)=>{
    state.user = user;
    if(user){
      document.getElementById('userBadge').textContent = user.email || user.uid;
      document.getElementById('btnSignOut').classList.remove('hidden');
      // ensure user record exists
      const snap = await db.ref('users/' + user.uid).once('value');
      if(!snap.exists()){
        await db.ref('users/' + user.uid).set({ email: user.email || null, balance: 1000, createdAt: Date.now() });
      }
      await refreshBalance();
      // update referral link
      document.getElementById('refLink').textContent = `${location.origin+location.pathname}?ref=${user.uid}`;
    } else {
      document.getElementById('userBadge').textContent = 'Not signed in';
      document.getElementById('btnSignOut').classList.add('hidden');
      document.getElementById('balanceSidebar').textContent = '—';
      document.getElementById('refLink').textContent = '—';
      refreshBetHistoryUI(); // will show login prompt
    }
  });

  /********** Wallet controls (demo) **********/
  document.getElementById('btnDemoDeposit').addEventListener('click', async ()=>{
    if(!state.user){ alert('Please login'); return; }
    const uid = state.user.uid;
    const delta = 1000;
    const snap = await db.ref('users/' + uid + '/balance').once('value');
    const cur = Number(snap.val() || 0);
    await db.ref('users/' + uid + '/balance').set(cur + delta);
    await refreshBalance();
    alert('Demo +1000 added');
  });

  document.getElementById('btnWithdraw').addEventListener('click', async ()=>{
    if(!state.user){ alert('Please login'); return; }
    const amt = Number(document.getElementById('withdrawAmount').value);
    if(!amt || amt <= 0) { alert('Enter valid amount'); return; }
    const uid = state.user.uid;
    const snap = await db.ref('users/' + uid + '/balance').once('value');
    const cur = Number(snap.val() || 0);
    if(cur < amt){ alert('Insufficient'); return; }
    await db.ref('users/' + uid + '/balance').set(cur - amt);
    await refreshBalance();
    alert('Demo withdraw processed (no real money moved).');
  });

  async function refreshBalance(){
    if(!state.user) return;
    const snap = await db.ref('users/' + state.user.uid + '/balance').once('value');
    const bal = Number(snap.val() || 0);
    state.balance = bal;
    document.getElementById('balanceSidebar').textContent = bal;
  }

  /********** Betting UI selection **********/
  function clearSelection(){
    document.querySelectorAll('.bet-option').forEach(el => el.classList.remove('selected'));
    state.selectedBet = null;
    document.getElementById('selectedText').textContent = '—';
  }

  document.querySelectorAll('.bet-option').forEach(el=>{
    el.addEventListener('click', ()=>{
      const was = el.classList.contains('selected');
      clearSelection();
      if(!was){
        el.classList.add('selected');
        const bet = el.getAttribute('data-bet');
        const mult = Number(el.getAttribute('data-mult') || 2);
        const type = (bet === 'odd' || bet === 'even') ? 'parity' : 'wingo';
        state.selectedBet = { type, value: bet, mult };
        document.getElementById('selectedText').textContent = `${type} → ${bet} (x${mult})`;
      }
    });
  });

  document.getElementById('btnAutoRepeat').addEventListener('click', ()=>{
    state.autoRepeat = !state.autoRepeat;
    document.getElementById('btnAutoRepeat').textContent = state.autoRepeat ? 'Auto: On' : 'Auto: Off';
  });

  /********** Place Bet **********/
  document.getElementById('placeBetBtn').addEventListener('click', async ()=>{
    if(!state.user){ alert('Please login to place bets'); return; }
    if(!state.selectedBet){ alert('Select bet option'); return; }
    const amt = Number(document.getElementById('betAmount').value);
    if(!amt || amt <= 0){ alert('Enter valid amount'); return; }

    // check and debit (hold)
    const uid = state.user.uid;
    const userSnap = await db.ref('users/' + uid).once('value');
    const curBal = Number((userSnap.val() && userSnap.val().balance) || 0);
    if(curBal < amt){ alert('Insufficient balance'); return; }
    await db.ref('users/' + uid + '/balance').set(curBal - amt);
    await refreshBalance();

    // write bet to DB under current period
    const period = state.period;
    const betData = {
      uid,
      email: state.user.email || null,
      type: state.selectedBet.type,
      value: state.selectedBet.value,
      amount: amt,
      mult: state.selectedBet.mult,
      period,
      status: 'pending',
      createdAt: Date.now()
    };
    const newRef = db.ref('bets/' + period).push();
    await newRef.set(betData);

    // local feedback
    alert('Bet placed for period ' + period);
    clearSelection();
    refreshBetHistoryUI();
  });

  /********** Timer & Round logic **********/
  function startRound(){
    const dur = Number(document.getElementById('roundDuration').value) || 30;
    state.roundDuration = dur;
    state.timeLeft = dur;
    document.getElementById('periodNumber').textContent = state.period;
    document.getElementById('countdown').textContent = fmtTime(state.timeLeft);
  }

  let tickInterval = null;
  function tick(){
    state.timeLeft -= 1;
    document.getElementById('countdown').textContent = fmtTime(state.timeLeft);
    if(state.timeLeft <= 0){
      resolveRound(state.period).catch(e => console.error(e));
      state.period += 1;
      startRound();
    }
  }

  // start ticking
  startRound();
  if(tickInterval) clearInterval(tickInterval);
  tickInterval = setInterval(tick, 1000);

  document.getElementById('roundDuration').addEventListener('change', ()=>{
    const newDur = Number(document.getElementById('roundDuration').value) || 30;
    state.roundDuration = newDur;
    state.timeLeft = newDur;
  });

  document.getElementById('btnNextRound').addEventListener('click', ()=> {
    state.timeLeft = 0; // will trigger resolve on next tick
  });

  /********** Result generation & settlement **********/
  function generateResult(){
    const number = Math.floor(Math.random()*10);
    const colors = ['red','green','blue','yellow'];
    const color = colors[Math.floor(Math.random()*colors.length)];
    return { number,
