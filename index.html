<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Investment Website</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {margin:0; font-family:Arial, sans-serif; background:#f5f5f5;}
    header {background:#4CAF50; color:white; padding:10px; text-align:center; font-size:18px;}
    section {display:none; padding:15px; margin-bottom:60px;}
    nav {display:flex; justify-content:space-around; background:#333; position:fixed; bottom:0; width:100%; padding:5px 0;}
    nav a {color:white; text-decoration:none; text-align:center; flex:1;}
    nav div {font-size:20px;}
    nav small {display:block; font-size:12px;}
    nav a:hover {background:#575757;}
    .btn {display:block; width:100%; padding:10px; margin:5px 0; background:#4CAF50; color:white; border:none; border-radius:5px;}
    .card {background:white; padding:15px; border-radius:5px; margin:10px 0;}
    input, textarea, select {width:100%; padding:8px; margin:5px 0; border:1px solid #ccc; border-radius:4px;}
  </style>
</head>
<body>

<header>Investment Website</header>

<section id="home">
  <h2>Home</h2>
  <p>Welcome to our investment platform.</p>
</section>

<section id="invest">
  <h2>Invest</h2>
  <p>Choose a plan to invest in.</p>
</section>

<section id="blog">
  <h2>Blog</h2>
  <p>Latest news and updates.</p>
</section>

<section id="notice">
  <h2>Notice</h2>
  <p>Important announcements.</p>
</section>

<section id="account">
  <h2>Account</h2>
  <div class="card">
    <h3>Wallet Balance: ‚Çπ<span id="wallet-balance">0</span></h3>
    <button class="btn" onclick="showSubPage('deposit')">Deposit</button>
    <button class="btn" onclick="showSubPage('withdraw')">Withdraw</button>
    <button class="btn" onclick="showSubPage('bank-card')">Bank Card</button>
    <button class="btn" onclick="showSubPage('transactions')">Transaction History</button>
    <button class="btn" onclick="showSubPage('my-product')">My Product</button>
    <button class="btn" onclick="showSubPage('customer-service')">Customer Service</button>
    <button class="btn" onclick="resetPassword()">Reset Password</button>
    <button class="btn" onclick="logout()">Logout</button>
  </div>
</section>

<!-- Deposit Page -->
<section id="deposit" class="subpage">
  <h2>Deposit</h2>
  <input type="number" id="deposit-amount" placeholder="Enter amount">
  <button class="btn" onclick="deposit()">Request Deposit</button>
  <button class="btn" onclick="backToAccount()">Back</button>
</section>

<!-- Withdraw Page -->
<section id="withdraw" class="subpage">
  <h2>Withdraw</h2>
  <input type="number" id="withdraw-amount" placeholder="Enter amount">
  <button class="btn" onclick="withdraw()">Request Withdrawal</button>
  <button class="btn" onclick="backToAccount()">Back</button>
</section>

<!-- Bank Card Page -->
<section id="bank-card" class="subpage">
  <h2>Bank Card</h2>
  <input type="text" id="bank-name" placeholder="Bank Name">
  <input type="text" id="account-number" placeholder="Account Number">
  <input type="text" id="ifsc-code" placeholder="IFSC Code">
  <button class="btn" onclick="saveBankCard()">Save Bank Details</button>
  <button class="btn" onclick="backToAccount()">Back</button>
</section>

<!-- Transactions Page -->
<section id="transactions" class="subpage">
  <h2>Transaction History</h2>
  <div id="transactions-list"></div>
  <button class="btn" onclick="backToAccount()">Back</button>
</section>

<!-- My Product Page -->
<section id="my-product" class="subpage">
  <h2>My Product</h2>
  <div id="my-product-list"></div>
  <button class="btn" onclick="backToAccount()">Back</button>
</section>

<!-- Customer Service Page -->
<section id="customer-service" class="subpage">
  <h2>Customer Service</h2>
  <textarea id="cs-message" placeholder="Type your message"></textarea>
  <button class="btn" onclick="sendMessage()">Send</button>
  <button class="btn" onclick="backToAccount()">Back</button>
</section>

<!-- Bottom Navigation -->
<nav>
  <a href="#" onclick="showSection('home')">
    <div>üè†</div>
    <small>Home</small>
  </a>
  <a href="#" onclick="showSection('invest')">
    <div>üíπ</div>
    <small>Invest</small>
  </a>
  <a href="#" onclick="showSection('blog')">
    <div>üì∞</div>
    <small>Blog</small>
  </a>
  <a href="#" onclick="showSection('notice')">
    <div>üì¢</div>
    <small>Notice</small>
  </a>
  <a href="#" onclick="showSection('account')">
    <div>üë§</div>
    <small>Account</small>
  </a>
</nav>

<script>
function showSection(id){
  document.querySelectorAll('section').forEach(sec => sec.style.display='none');
  document.getElementById(id).style.display='block';
}
function showSubPage(id){
  document.querySelectorAll('#account, .subpage').forEach(sec => sec.style.display='none');
  document.getElementById(id).style.display='block';
}
function backToAccount(){
  document.querySelectorAll('.subpage').forEach(sec => sec.style.display='none');
  document.getElementById('account').style.display='block';
}
showSection('home');
</script>
<!-- Firebase & App Logic -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDvF1KrDDRZJucp-78dbvmQ34Oi3j17Rrk",
  authDomain: "investment-website-deml.firebaseapp.com",
  projectId: "investment-website-deml",
  storageBucket: "investment-website-deml.firebasestorage.app",
  messagingSenderId: "814451995593",
  appId: "1:814451995593:web:55e3280d9cb43200f1ee18",
  measurementId: "G-8FKZE5NNSX"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let currentUserId = null;

// Auto login for testing (replace with real login UI)
auth.signInAnonymously().then(user => {
  currentUserId = user.user.uid;
  loadWallet();
}).catch(console.error);

function loadWallet(){
  db.collection("wallets").doc(currentUserId).get().then(doc=>{
    if(doc.exists){
      document.getElementById("wallet-balance").textContent = doc.data().balance || 0;
    } else {
      db.collection("wallets").doc(currentUserId).set({balance:0});
      document.getElementById("wallet-balance").textContent = 0;
    }
  });
}

function deposit(){
  let amount = parseFloat(document.getElementById("deposit-amount").value);
  if(isNaN(amount) || amount <= 0) return alert("Enter valid amount");
  db.collection("depositRequests").add({
    userId: currentUserId,
    amount: amount,
    status: "pending",
    time: firebase.firestore.FieldValue.serverTimestamp()
  }).then(()=>{
    alert("Deposit request submitted");
    document.getElementById("deposit-amount").value = "";
  });
}

function withdraw(){
  let amount = parseFloat(document.getElementById("withdraw-amount").value);
  if(isNaN(amount) || amount <= 0) return alert("Enter valid amount");
  db.collection("withdrawRequests").add({
    userId: currentUserId,
    amount: amount,
    status: "pending",
    time: firebase.firestore.FieldValue.serverTimestamp()
  }).then(()=>{
    alert("Withdrawal request submitted");
    document.getElementById("withdraw-amount").value = "";
  });
}

function saveBankCard(){
  let bankName = document.getElementById("bank-name").value;
  let accNumber = document.getElementById("account-number").value;
  let ifsc = document.getElementById("ifsc-code").value;
  if(!bankName || !accNumber || !ifsc) return alert("Fill all fields");
  db.collection("bankCards").doc(currentUserId).set({
    bankName, accNumber, ifsc
  }).then(()=> alert("Bank details saved"));
}

function logout(){
  auth.signOut().then(()=> location.reload());
}

function resetPassword(){
  let email = prompt("Enter your email to reset password:");
  if(email){
    auth.sendPasswordResetEmail(email).then(()=> alert("Password reset email sent"))
    .catch(err=> alert(err.message));
  }
}

function sendMessage(){
  let msg = document.getElementById("cs-message").value;
  if(!msg) return alert("Enter message");
  db.collection("customerService").add({
    userId: currentUserId,
    message: msg,
    time: firebase.firestore.FieldValue.serverTimestamp()
  }).then(()=>{
    alert("Message sent");
    document.getElementById("cs-message").value = "";
  });
}

// Load transactions
function loadTransactions(){
  let list = document.getElementById("transactions-list");
  list.innerHTML = "Loading...";
  db.collection("transactions").where("userId","==",currentUserId)
    .orderBy("time","desc").get().then(snapshot=>{
      list.innerHTML = "";
      snapshot.forEach(doc=>{
        let t = doc.data();
        list.innerHTML += `<div class='card'>${t.type}: ‚Çπ${t.amount} (${t.status})</div>`;
      });
    });
}
document.querySelector("[onclick=\"showSubPage('transactions')\"]").addEventListener("click", loadTransactions);

// Admin: View deposit/withdraw requests
function loadAdminPanel(){
  let adminPass = prompt("Enter admin password:");
  if(adminPass !== "admin123") return alert("Wrong password");
  document.body.innerHTML = "<h2>Admin Panel</h2><div id='admin-deposits'></div><div id='admin-withdrawals'></div>";
  
  db.collection("depositRequests").orderBy("time","desc").onSnapshot(snapshot=>{
    let html = "<h3>Deposit Requests</h3>";
    snapshot.forEach(doc=>{
      let d = doc.data();
      html += `<div class='card'>User: ${d.userId} | ‚Çπ${d.amount} | ${d.status} 
      <button onclick="approveDeposit('${doc.id}', ${d.amount}, '${d.userId}')">Approve</button>
      </div>`;
    });
    document.getElementById("admin-deposits").innerHTML = html;
  });

  db.collection("withdrawRequests").orderBy("time","desc").onSnapshot(snapshot=>{
    let html = "<h3>Withdrawal Requests</h3>";
    snapshot.forEach(doc=>{
      let d = doc.data();
      html += `<div class='card'>User: ${d.userId} | ‚Çπ${d.amount} | ${d.status} 
      <button onclick="approveWithdraw('${doc.id}', ${d.amount}, '${d.userId}')">Approve</button>
      </div>`;
    });
    document.getElementById("admin-withdrawals").innerHTML = html;
  });
}

function approveDeposit(docId, amount, userId){
  db.collection("wallets").doc(userId).get().then(doc=>{
    let bal = doc.exists ? doc.data().balance || 0 : 0;
    db.collection("wallets").doc(userId).set({balance: bal + amount});
    db.collection("transactions").add({userId, amount, type:"Deposit", status:"completed", time:firebase.firestore.FieldValue.serverTimestamp()});
    db.collection("depositRequests").doc(docId).update({status:"approved"});
  });
}

function approveWithdraw(docId, amount, userId){
  db.collection("wallets").doc(userId).get().then(doc=>{
    let bal = doc.exists ? doc.data().balance || 0 : 0;
    if(bal >= amount){
      db.collection("wallets").doc(userId).set({balance: bal - amount});
      db.collection("transactions").add({userId, amount, type:"Withdrawal", status:"completed", time:firebase.firestore.FieldValue.serverTimestamp()});
      db.collection("withdrawRequests").doc(docId).update({status:"approved"});
    } else {
      alert("Insufficient funds");
    }
  });
}
</script>

<!-- Admin Access Button -->
<button onclick="loadAdminPanel()" style="position:fixed;top:10px;right:10px;">Admin</button>

</body>
</html>
