<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Win89 - Color Prediction Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6fa;
      margin: 0;
      padding-bottom: 100px;
      text-align: center;
    }
    header {
      background: #0d6efd;
      color: white;
      padding: 10px;
    }
    header img {
      height: 40px;
      vertical-align: middle;
    }
    header h1 {
      display: inline;
      font-size: 1.5rem;
      margin-left: 10px;
    }
    nav button {
      padding: 10px;
      margin: 5px;
      background: #198754;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 6px;
    }
    .section {
      display: none;
      padding: 20px;
    }
    .visible {
      display: block;
    }
    input, select {
      padding: 10px;
      margin: 5px;
      width: 80%;
      max-width: 300px;
    }
    button.placeBetBtn {
      background: #dc3545;
      color: white;
      padding: 12px 20px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<header>
  <img src="https://i.ibb.co/2yyf9Rw/win89-logo.png" alt="Win89 Logo" />
  <h1>Win89</h1>
</header>

<nav>
  <button onclick="showSection('loginSection')">Login</button>
  <button onclick="showSection('registerSection')">Register</button>
  <button onclick="showSection('walletSection')">Wallet</button>
  <button onclick="showSection('lotterySection')">Wingo</button>
  <button onclick="showSection('historySection')">Bet History</button>
  <button onclick="showSection('leaderboardSection')">Leaderboard</button>
</nav>

<!-- Sections will come next -->
  <!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBe5kGOwYS3FsF_9_q1pjxaWrF1glUe87c",
    authDomain: "wingologin.firebaseapp.com",
    databaseURL: "https://wingologin-default-rtdb.firebaseio.com",
    projectId: "wingologin",
    storageBucket: "wingologin.firebasestorage.app",
    messagingSenderId: "605536859710",
    appId: "1:605536859710:web:ed9495775c8f8dd6a8836f",
    measurementId: "G-FLDY936H9P"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  let currentUser = null;

  function showSection(id) {
    document.querySelectorAll('.section').forEach(sec => sec.classList.remove('visible'));
    document.getElementById(id).classList.add('visible');
  }
</script>

<!-- Login Section -->
<div id="loginSection" class="section visible">
  <h2>Login to Win89</h2>
  <input id="loginEmail" placeholder="Email" type="email" />
  <input id="loginPassword" placeholder="Password" type="password" />
  <button onclick="login()">Login</button>
</div>

<!-- Register Section -->
<div id="registerSection" class="section">
  <h2>Register for Win89</h2>
  <input id="registerEmail" placeholder="Email" type="email" />
  <input id="registerPassword" placeholder="Password" type="password" />
  <input id="referralCode" placeholder="Referral Code (optional)" />
  <button onclick="register()">Register</button>
</div>

<script>
  function login() {
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPassword").value;
    auth.signInWithEmailAndPassword(email, password)
      .then(user => {
        currentUser = user.user;
        alert("Logged in!");
        showSection("walletSection");
      })
      .catch(err => alert(err.message));
  }

  function register() {
    const email = document.getElementById("registerEmail").value;
    const password = document.getElementById("registerPassword").value;
    const referral = document.getElementById("referralCode").value;
    auth.createUserWithEmailAndPassword(email, password)
      .then(user => {
        currentUser = user.user;
        db.ref("users/" + currentUser.uid).set({
          email: email,
          wallet: 100,
          referral: referral || ""
        });
        alert("Registered!");
        showSection("walletSection");
      })
      .catch(err => alert(err.message));
  }

  auth.onAuthStateChanged(user => {
    if (user) {
      currentUser = user;
    }
  });
</script>

<!-- Wallet Section -->
<div id="walletSection" class="section">
  <h2>Wallet</h2>
  <p>Your balance: ‚Çπ<span id="walletBalance">0</span></p>
</div>

<script>
  function updateWallet() {
    if (!currentUser) return;
    db.ref("users/" + currentUser.uid + "/wallet").on("value", snapshot => {
      document.getElementById("walletBalance").textContent = snapshot.val() || 0;
    });
  }

  auth.onAuthStateChanged(user => {
    if (user) {
      currentUser = user;
      updateWallet();
    }
  });
</script>
<!-- Lottery Game Section (Wingo) -->
<div id="lotterySection" class="section">
  <h2>Wingo Game</h2>
  <p>Period No: <span id="periodNumber">-</span></p>
  <p>Time Left: <span id="countdown">--</span> seconds</p>

  <select id="betColor">
    <option value="">Select Color</option>
    <option value="red">üî¥ Red</option>
    <option value="green">üü¢ Green</option>
    <option value="blue">üîµ Blue</option>
    <option value="violet">üü£ Violet</option>
  </select><br/>

  <input id="betAmount" placeholder="Enter amount" type="number" min="1" /><br/>
  <button class="placeBetBtn" onclick="placeBet()">Place Bet</button>

  <p id="betMessage"></p>
</div>

<script>
  // Shared Period & Timer Logic
  let currentPeriod = 1001;
  let timeLeft = 60;

  function updatePeriodAndTimer() {
    document.getElementById("periodNumber").textContent = currentPeriod;
    document.getElementById("countdown").textContent = timeLeft;

    const interval = setInterval(() => {
      timeLeft--;
      document.getElementById("countdown").textContent = timeLeft;

      if (timeLeft <= 0) {
        clearInterval(interval);
        timeLeft = 60;
        currentPeriod++;
        generateResult();
        updatePeriodAndTimer();
      }
    }, 1000);
  }

  updatePeriodAndTimer();

  // Place Bet Logic
  function placeBet() {
    if (!currentUser) return alert("Please login");
    const color = document.getElementById("betColor").value;
    const amount = parseInt(document.getElementById("betAmount").value);
    if (!color || isNaN(amount) || amount <= 0) return alert("Enter valid bet");

    const uid = currentUser.uid;
    const betRef = db.ref("bets/" + currentPeriod + "/" + uid);

    // Check wallet balance
    db.ref("users/" + uid + "/wallet").once("value", snapshot => {
      const balance = snapshot.val() || 0;
      if (balance < amount) {
        alert("Insufficient balance");
        return;
      }

      // Save bet
      betRef.set({
        color: color,
        amount: amount,
        time: Date.now()
      });

      // Deduct from wallet
      db.ref("users/" + uid).update({
        wallet: balance - amount
      });

      document.getElementById("betMessage").textContent = `Bet placed on ${color.toUpperCase()} for ‚Çπ${amount}`;
    });
  }
</script>
<script>
  // Function to generate random color result
  function generateResult() {
    const colors = ["red", "green", "blue", "violet"];
    const resultColor = colors[Math.floor(Math.random() * colors.length)];
    db.ref("results/" + currentPeriod).set({
      color: resultColor,
      time: Date.now()
    });

    payWinners(resultColor);
  }

  // Pay winning users
  function payWinners(resultColor) {
    const betRef = db.ref("bets/" + currentPeriod);
    betRef.once("value", snapshot => {
      if (!snapshot.exists()) return;

      snapshot.forEach(userBet => {
        const uid = userBet.key;
        const data = userBet.val();
        if (data.color === resultColor) {
          // Win: payout 2x
          const winAmount = data.amount * 2;
          const userWalletRef = db.ref("users/" + uid + "/wallet");
          userWalletRef.once("value", snap => {
            const currentBal = snap.val() || 0;
            userWalletRef.set(currentBal + winAmount);
          });
        }
      });
    });
  }
</script>
<!-- Bet History Section -->
<div id="historySection" class="section">
  <h2>Bet History</h2>
  <div id="betHistoryList"></div>
</div>

<script>
  function loadBetHistory() {
    if (!currentUser) return;

    const uid = currentUser.uid;
    const betHistoryDiv = document.getElementById("betHistoryList");
    betHistoryDiv.innerHTML = "Loading...";

    db.ref("bets").once("value", snapshot => {
      let html = "";

      snapshot.forEach(periodSnap => {
        const period = periodSnap.key;
        const userBet = periodSnap.child(uid);
        if (userBet.exists()) {
          const data = userBet.val();
          const color = data.color;
          const amount = data.amount;

          db.ref("results/" + period + "/color").once("value", snap => {
            const resultColor = snap.val();
            const won = resultColor === color;
            const resultText = won ? "‚úÖ Win" : "‚ùå Lose";

            html += `
              <div style="border:1px solid #ccc; padding:10px; margin:10px;">
                <strong>Period:</strong> ${period}<br/>
                <strong>Color:</strong> ${color}<br/>
                <strong>Amount:</strong> ‚Çπ${amount}<br/>
                <strong>Result:</strong> ${resultColor} ${resultText}
              </div>
            `;
            betHistoryDiv.innerHTML = html;
          });
        }
      });

      if (html === "") {
        betHistoryDiv.innerHTML = "No bets placed yet.";
      }
    });
  }

  // Load bet history every time the section is shown
  function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('visible'));
    document.getElementById(id).classList.add('visible');

    if (id === "historySection") loadBetHistory();
  }
</script>
<!-- Leaderboard Section -->
<div id="leaderboardSection" class="section">
  <h2>üèÜ Leaderboard - Top Earners</h2>
  <div id="leaderboardList">Loading...</div>
</div>

<script>
  function loadLeaderboard() {
    const listDiv = document.getElementById("leaderboardList");
    listDiv.innerHTML = "Loading...";

    db.ref("users")
      .orderByChild("wallet")
      .limitToLast(10)
      .once("value", snapshot => {
        const users = [];
        snapshot.forEach(child => {
          users.push({
            name: child.val().name || "User",
            wallet: child.val().wallet || 0
          });
        });

        users.reverse(); // High to low
        let html = "";
        users.forEach((u, i) => {
          html += `
            <div style="border-bottom:1px solid #ddd;padding:5px;">
              <strong>#${i + 1}</strong> ${u.name} ‚Äî ‚Çπ${u.wallet}
            </div>
          `;
        });

        listDiv.innerHTML = html || "No data available.";
      });
  }

  // Load leaderboard every time it's shown
  function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('visible'));
    document.getElementById(id).classList.add('visible');

    if (id === "leaderboardSection") loadLeaderboard();
    else if (id === "historySection") loadBetHistory();
  }
</script>
<!-- Admin Panel Section -->
<div id="adminPanelSection" class="section">
  <h2>üõ†Ô∏è Admin Result Panel</h2>
  <div>
    <label>Set Result for Period: <strong id="adminPeriodDisplay">...</strong></label><br/>
    <select id="manualResultColor">
      <option value="red">Red</option>
      <option value="green">Green</option>
      <option value="blue">Blue</option>
      <option value="violet">Violet</option>
    </select>
    <button onclick="submitManualResult()">Submit Manual Result</button>
    <p id="adminStatus"></p>
  </div>
</div>

<script>
  const adminUIDs = [
    "ADMIN_UID_HERE",  // replace with your Firebase UID
  ];

  function isAdmin() {
    return currentUser && adminUIDs.includes(currentUser.uid);
  }

  function showAdminPanel() {
    if (isAdmin()) {
      document.getElementById("adminPanelSection").style.display = "block";
      document.getElementById("adminPeriodDisplay").textContent = currentPeriod;
    } else {
      alert("Access denied: Admins only.");
    }
  }

  function submitManualResult() {
    const color = document.getElementById("manualResultColor").value;
    db.ref("results/" + currentPeriod).set({
      color: color,
      manual: true,
      time: Date.now()
    });
    document.getElementById("adminStatus").textContent = "Result set manually to " + color;
    payWinners(color);
  }
</script>
<!-- Footer -->
<footer style="position: fixed; bottom: 0; width: 100%; background: #333; color: white; padding: 10px; text-align: center;">
  ¬© 2025 Win89 - All rights reserved.
</footer>

</body>
</html>
