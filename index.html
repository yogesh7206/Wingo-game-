<!DOCTYPE html>
<html>
<head>
  <title>Wingo Game</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- üîê Login/Signup Section -->
  <h2>Login / Signup</h2>
  <input type="email" id="email" placeholder="Email"><br><br>
  <input type="password" id="password" placeholder="Password"><br><br>
  <button onclick="signup()">Sign Up</button>
  <button onclick="login()">Log In</button>
  <button onclick="logout()">Log Out</button>
  <p id="message"></p>

  <!-- üéÆ Wingo Game Section (Hidden by default) -->
  <div id="game" style="display: none;">
    <h1>üéØ Wingo Game</h1>
    <p><strong>Game ID:</strong> <span id="gameid">Loading...</span></p>
    <p><strong>Wallet:</strong> ‚Çπ<span id="wallet">1000</span></p>
    <p>Timer: <span id="countdown">60</span>s</p>

    <label>Pick Color:</label><br>
    <button onclick="selectColor('RED')">üî¥ RED</button>
    <button onclick="selectColor('GREEN')">üü¢ GREEN</button>
    <button onclick="selectColor('VIOLET')">üü£ VIOLET</button><br><br>

    <label>Bet Amount (‚Çπ):</label>
    <input id="bet" type="number" value="10"><br><br>
    <button onclick="placeBet()">Place Bet</button>

    <p id="result"></p>
    <p>Last Results: <span id="history"></span></p>
  </div>

  <!-- üéÆ Local Game Logic -->
  <script>
    let selectedColor = '';
    let balance = 1000;

    function selectColor(color) {
      selectedColor = color;
    }

    function placeBet() {
      const betAmount = parseInt(document.getElementById('bet').value);
      const resultText = document.getElementById('result');

      if (isNaN(betAmount) || betAmount <= 0) {
        resultText.innerText = "‚ùå Please enter a valid bet amount.";
        return;
      }

      if (betAmount > balance) {
        resultText.innerText = "‚ùå Insufficient wallet balance.";
        return;
      }

      const colors = ['RED', 'GREEN', 'VIOLET'];
      const resultColor = colors[Math.floor(Math.random() * 3)];

      if (selectedColor === resultColor) {
        balance += betAmount * 2;
        resultText.innerText = `üéâ You won! Result was ${resultColor}`;
      } else {
        balance -= betAmount;
        resultText.innerText = `üò¢ You lost! Result was ${resultColor}`;
      }

      document.getElementById('wallet').innerText = balance;
      updateHistory(resultColor);
    }

    function updateHistory(result) {
      const history = document.getElementById('history');
      history.innerText = result + " " + history.innerText;
    }
  </script>

  <!-- ‚úÖ Firebase Auth + Database -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged }
      from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBe5kGOwYS3FsF_9_q1pjxaWrF1glUe87c",
      authDomain: "wingologin.firebaseapp.com",
      projectId: "wingologin",
      storageBucket: "wingologin.appspot.com",
      messagingSenderId: "605536859710",
      appId: "1:605536859710:web:ed9495775c8f8dd6a8836f",
      measurementId: "G-FLDY936H9P"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    // Auth State Listener
    onAuthStateChanged(auth, async (user) => {
      const gameDiv = document.getElementById("game");
      const message = document.getElementById("message");
      const gameIdSpan = document.getElementById("gameid");
      const walletSpan = document.getElementById("wallet");

      if (user) {
        const uid = user.uid;
        const userRef = ref(db, "users/" + uid);
        let gameID;
        let wallet;

        const snapshot = await get(userRef);
        if (snapshot.exists()) {
          const data = snapshot.val();
          gameID = data.gameID || generateGameID();
          wallet = data.wallet || 1000;
        } else {
          gameID = generateGameID();
          wallet = 1000;
        }

        // Save to Firebase if not already there
        await set(userRef, { gameID: gameID, wallet: wallet });

        balance = wallet; // load into game balance

        // Update UI
        gameIdSpan.innerText = gameID;
        walletSpan.innerText = balance;
        message.innerText = `‚úÖ Logged in as: ${user.email}`;
        gameDiv.style.display = "block";
      } else {
        gameDiv.style.display = "none";
        message.innerText = "üîí You are logged out.";
      }
    });

    // Random 6-digit ID
    function generateGameID() {
      return Math.floor(100000 + Math.random() * 900000);
    }

    // Signup
    window.signup = function () {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      createUserWithEmailAndPassword(auth, email, password)
        .then(() => {
          document.getElementById("message").innerText = "‚úÖ Sign up successful!";
        })
        .catch((error) => {
          document.getElementById("message").innerText = "‚ùå " + error.message;
        });
    };

    // Login
    window.login = function () {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      signInWithEmailAndPassword(auth, email, password)
        .then(() => {
          document.getElementById("message").innerText = "‚úÖ Login successful!";
        })
        .catch((error) => {
          document.getElementById("message").innerText = "‚ùå " + error.message;
        });
    };

    // Logout
    window.logout = function () {
      signOut(auth).then(() => {
        document.getElementById("message").innerText = "‚úÖ Logged out.";
      });
    };
  </script>
</body>
</html>
