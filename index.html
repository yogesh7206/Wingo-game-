<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Win89 - Investment Platform</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {font-family: Arial, sans-serif; margin:0; background:#f5f5f5;}
header {background:#4CAF50; color:#fff; padding:15px; text-align:center;}
nav {display:flex; justify-content:space-around; background:#333; position:fixed; bottom:0; width:100%;}
nav a {color:white; padding:14px 20px; text-decoration:none; display:block;}
nav a:hover {background:#575757;}
section {display:none; padding:20px; margin-bottom:60px;}
.active {display:block;}
.card {background:#fff; padding:15px; margin:10px 0; border-radius:5px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
button {padding:10px 15px; border:none; background:#4CAF50; color:white; border-radius:5px; cursor:pointer;}
button:hover {background:#45a049;}
input, textarea {width:100%; padding:8px; margin:5px 0; box-sizing:border-box;}
</style>
</head>
<body>

<header>
  <h1>Win89</h1>
  <p>Wallet Balance: ₹<span id="wallet-balance">0</span></p>
</header>

<!-- Navigation -->
<nav>
  <a href="#" onclick="showSection('home')">Home</a>
  <a href="#" onclick="showSection('invest')">Invest</a>
  <a href="#" onclick="showSection('blog')">Blog</a>
  <a href="#" onclick="showSection('notice')">Notice</a>
  <a href="#" onclick="showSection('account')">Account</a>
</nav>

<!-- Home -->
<section id="home" class="active">
  <div class="card"><h2>Welcome to Win89</h2><p>Your trusted investment platform.</p></div>
  <div class="card">
    <h3>Team</h3>
    <button onclick="showSection('team')">View Team</button>
  </div>
</section>

<!-- Invest -->
<section id="invest">
  <div class="card"><h2>Investment Plans</h2><p>Coming soon...</p></div>
</section>

<!-- Blog -->
<section id="blog">
  <div class="card"><h2>Latest Blog</h2><p>Stay updated with tips.</p></div>
</section>

<!-- Notice -->
<section id="notice">
  <div class="card"><h2>Notice Board</h2><p>Updates appear here.</p></div>
</section>

<!-- Account -->
<section id="account">
  <div class="card"><h2>My Account</h2>
    <button onclick="showSection('wallet-records')">Wallet Records</button>
    <button onclick="showSection('withdrawal')">Withdrawal</button>
    <button onclick="showSection('bank-card')">Bank Card</button>
    <button onclick="showSection('transactions')">Transactions</button>
    <button onclick="showSection('my-product')">My Product</button>
    <button onclick="showSection('customer-service')">Customer Service</button>
    <button onclick="resetPassword()">Reset Password</button>
  </div>
</section>

<!-- Sub Pages -->
<section id="team"><div class="card"><h2>My Team</h2></div></section>
<section id="bank-card">
  <div class="card"><h2>Bind Bank Card</h2>
    <input type="text" id="bank-name" placeholder="Bank Name">
    <input type="text" id="account-number" placeholder="Account Number">
    <input type="text" id="ifsc-code" placeholder="IFSC Code">
    <input type="text" id="account-holder" placeholder="Account Holder Name">
    <button onclick="saveBankCard()">Save</button>
  </div>
</section>
<section id="wallet-records"><div class="card"><h2>Wallet Records</h2><div id="wallet-record-list"></div></div></section>
<section id="withdrawal">
  <div class="card"><h2>Withdrawal</h2>
    <input type="number" id="withdraw-amount" placeholder="Enter amount">
    <button onclick="requestWithdrawal()">Request</button>
  </div>
</section>
<section id="transactions"><div class="card"><h2>Transactions</h2><div id="transactions-list"></div></div></section>
<section id="my-product"><div class="card"><h2>My Product</h2></div></section>
<section id="customer-service">
  <div class="card"><h2>Customer Service</h2>
    <textarea id="cs-message" placeholder="Write message"></textarea>
    <button onclick="sendMessage()">Send</button>
  </div>
</section>
<section id="admin-panel"><div class="card"><h2>Admin Panel</h2><div id="deposit-requests"></div><div id="withdrawal-requests"></div></div></section>

<script>
function showSection(id){
  document.querySelectorAll("section").forEach(sec=>sec.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}
</script>
<!-- ========= Part 2: Firebase + Logic (paste after Part 1) ========= -->

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
// ---------- 1) Firebase init (your config) ----------
var firebaseConfig = {
  apiKey: "AIzaSyDvF1KrDDRZJucp-78dbvmQ34Oi3j17Rrk",
  authDomain: "investment-website-deml.firebaseapp.com",
  projectId: "investment-website-deml",
  storageBucket: "investment-website-deml.firebasestorage.app",
  messagingSenderId: "814451995593",
  appId: "1:814451995593:web:55e3280d9cb43200f1ee18",
  measurementId: "G-8FKZE5NNSX"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db   = firebase.database();

// Refs
const usersRef    = db.ref('users');
const cardsRef    = db.ref('bankCards');     // by uid
const txRef       = db.ref('transactions');  // all tx
const supportRef  = db.ref('support');
const withdrawRef = db.ref('withdrawals');   // user requests
const depositRef  = db.ref('deposits');      // user deposit requests (admin sees here)

// helpers
const $ = id => document.getElementById(id);
const formatRs = v => (Math.round((v||0)*100)/100).toFixed(2);

// ---------- 2) Sign-in (anonymous demo) ----------
let currentUser = null;
auth.signInAnonymously().catch(e=>console.warn('Anon sign-in error:', e));

auth.onAuthStateChanged(async (user)=>{
  currentUser = user;
  if(!user) return;
  const uid = user.uid;

  // ensure profile
  const snap = await usersRef.child(uid).once('value');
  if(!snap.exists()){
    await usersRef.child(uid).set({
      wallet: 0,
      createdAt: Date.now()
    });
  }

  // live wallet balance
  usersRef.child(uid).on('value', s=>{
    const u = s.val() || {};
    if($('wallet-balance')) $('wallet-balance').innerText = formatRs(u.wallet||0);
  });

  // load lists
  loadTransactions(uid);
  loadWalletRecords(uid);
  loadAdminDepositList();
  loadAdminWithdrawList();
});

// ---------- 3) BANK CARD ----------
window.saveBankCard = async function(){
  if(!currentUser) return alert('Please wait, signing in…');
  const uid = currentUser.uid;

  const bankName  = $('bank-name')?.value.trim();
  const accountNo = $('account-number')?.value.trim();
  const ifsc      = $('ifsc-code')?.value.trim();
  const holder    = $('account-holder')?.value.trim();

  if(!bankName || !accountNo || !ifsc || !holder){
    return alert('Please fill all fields.');
  }

  await cardsRef.child(uid).set({
    uid, bankName, accountNo, ifsc, holder, updatedAt: Date.now()
  });

  alert('Bank details saved.');
};

// ---------- 4) WITHDRAWAL ----------
window.requestWithdrawal = async function(){
  if(!currentUser) return alert('Please wait, signing in…');
  const uid = currentUser.uid;
  const amt = parseFloat($('withdraw-amount')?.value);

  if(!amt || amt<=0) return alert('Enter valid amount');

  // Create withdraw request (pending). Admin will approve/decline.
  const req = await withdrawRef.push({
    uid, amount: amt, status:'pending', time: Date.now()
  });

  // log a tx record (for user history)
  await txRef.push({ uid, type:'withdraw_request', amount: -amt, time: Date.now(), wid: req.key });

  $('withdraw-amount').value = '';
  alert('Withdrawal request submitted.');
  loadAdminWithdrawList(); // refresh admin view if open
};

// ---------- 5) CUSTOMER SERVICE ----------
window.sendMessage = async function(){
  if(!currentUser) return alert('Please wait, signing in…');
  const uid = currentUser.uid;
  const msg = $('cs-message')?.value.trim();
  if(!msg) return alert('Write a message first.');
  await supportRef.push({ uid, message: msg, status:'open', time: Date.now() });
  $('cs-message').value = '';
  alert('Message sent.');
};

// ---------- 6) RESET PASSWORD (email flow) ----------
window.resetPassword = function(){
  const email = prompt('Enter your email to receive reset link:');
  if(!email) return;
  auth.sendPasswordResetEmail(email)
      .then(()=> alert('Password reset email sent.'))
      .catch(err=> alert(err.message));
};

// ---------- 7) TRANSACTIONS & WALLET RECORDS ----------
function loadTransactions(uid){
  const list = $('transactions-list');
  if(!list) return;
  txRef.orderByChild('uid').equalTo(uid).limitToLast(200).on('value', snap=>{
    list.innerHTML = '';
    if(!snap.exists()) { list.innerHTML = '<p>No transactions.</p>'; return; }
    const arr = [];
    snap.forEach(s=>arr.push(s.val()));
    arr.reverse();
    arr.forEach(t=>{
      const row = document.createElement('div');
      row.className = 'card';
      row.innerHTML = `<b>${t.type}</b> — ₹${formatRs(t.amount||0)}
        <div class="muted">${new Date(t.time||Date.now()).toLocaleString()}</div>`;
      list.appendChild(row);
    });
  });
}

function loadWalletRecords(uid){
  const list = $('wallet-record-list');
  if(!list) return;
  txRef.orderByChild('uid').equalTo(uid).limitToLast(200).on('value', snap=>{
    list.innerHTML = '';
    if(!snap.exists()) { list.innerHTML = '<p>No wallet records.</p>'; return; }
    const arr = [];
    snap.forEach(s=>arr.push(s.val()));
    arr.reverse();
    arr.forEach(t=>{
      const row = document.createElement('div');
      row.className = 'card';
      row.innerHTML = `₹${formatRs(t.amount||0)} • ${t.type}
        <div class="muted">${new Date(t.time||Date.now()).toLocaleString()}</div>`;
      list.appendChild(row);
    });
  });
}

// ---------- 8) ADMIN PANEL: Deposit & Withdrawal lists ----------
function loadAdminDepositList(){
  const panel = $('deposit-requests');
  if(!panel) return;
  depositRef.orderByChild('status').equalTo('pending').on('value', snap=>{
    panel.innerHTML = '';
    if(!snap.exists()) { panel.innerHTML = '<p>No deposit requests.</p>'; return; }
    snap.forEach(child=>{
      const r = child.val();
      const div = document.createElement('div');
      div.className = 'card';
      div.innerHTML = `
        <b>Deposit:</b> ₹${formatRs(r.amount||0)}<br/>
        <span class="muted small">UID: ${r.uid || '-'}</span><br/>
        <span class="muted small">${new Date(r.time||Date.now()).toLocaleString()}</span>
        <div style="margin-top:8px">
          <button onclick="approveDeposit('${child.key}')">Approve</button>
          <button class="btn-ghost" onclick="declineDeposit('${child.key}')">Decline</button>
        </div>`;
      panel.appendChild(div);
    });
  });
}

function loadAdminWithdrawList(){
  const panel = $('withdrawal-requests');
  if(!panel) return;
  withdrawRef.orderByChild('status').equalTo('pending').on('value', snap=>{
    panel.innerHTML = '';
    if(!snap.exists()) { panel.innerHTML = '<p>No withdrawal requests.</p>'; return; }
    snap.forEach(child=>{
      const r = child.val();
      const div = document.createElement('div');
      div.className = 'card';
      div.innerHTML = `
        <b>Withdraw:</b> ₹${formatRs(r.amount||0)}<br/>
        <span class="muted small">UID: ${r.uid || '-'}</span><br/>
        <span class="muted small">${new Date(r.time||Date.now()).toLocaleString()}</span>
        <div style="margin-top:8px">
          <button onclick="approveWithdraw('${child.key}')">Approve</button>
          <button class="btn-ghost" onclick="declineWithdraw('${child.key}')">Decline</button>
        </div>`;
      panel.appendChild(div);
    });
  });
}

// Approve/Decline Deposit (credits wallet)
window.approveDeposit = async function(key){
  const snap = await depositRef.child(key).once('value');
  if(!snap.exists()) return alert('Not found');
  const r = snap.val();
  // credit user wallet
  await usersRef.child(r.uid).transaction(u => {
    if(!u) u = { wallet: 0 };
    u.wallet = (u.wallet||0) + (r.amount||0);
    return u;
  });
  // mark approved
  await depositRef.child(key).update({ status:'approved', approvedAt: Date.now() });
  await txRef.push({ uid:r.uid, type:'deposit_approved', amount:r.amount, time: Date.now() });
  alert('Deposit approved.');
};

window.declineDeposit = async function(key){
  await depositRef.child(key).update({ status:'declined', declinedAt: Date.now() });
  alert('Deposit declined.');
};

// Approve/Decline Withdraw (debits wallet)
window.approveWithdraw = async function(key){
  const snap = await withdrawRef.child(key).once('value');
  if(!snap.exists()) return alert('Not found');
  const r = snap.val();
  // debit user wallet
  await usersRef.child(r.uid).transaction(u => {
    if(!u) u = { wallet: 0 };
    u.wallet = (u.wallet||0) - (r.amount||0);
    return u;
  });
  // mark paid
  await withdrawRef.child(key).update({ status:'paid', paidAt: Date.now() });
  await txRef.push({ uid:r.uid, type:'withdraw_paid', amount:-r.amount, time: Date.now() });
  alert('Withdrawal marked as paid.');
};

window.declineWithdraw = async function(key){
  await withdrawRef.child(key).update({ status:'declined', declinedAt: Date.now() });
  alert('Withdrawal declined.');
};

// ---------- 9) (Optional) User creates a Deposit Request (no UI in Part 1) ----------
// If you later add a "Deposit" form, call this:
//   createDepositRequest(amount, note)
window.createDepositRequest = async function(amount, note){
  if(!currentUser) return alert('Please wait, signing in…');
  if(!amount || amount<=0) return alert('Enter valid amount');
  const uid = currentUser.uid;
  await depositRef.push({ uid, amount, note: note||'', status:'pending', time: Date.now() });
  await txRef.push({ uid, type:'deposit_request', amount, time: Date.now() });
  alert('Deposit request created.');
};
</script>
<!-- ========= End Part 2 ========= -->
