<!DOCTYPE html>
<html>
<head>
  <title>Wingo Game</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f6fa;
      text-align: center;
    }
    .hidden { display: none; }
    .section { padding: 20px; }
    button {
      padding: 10px 16px;
      margin: 5px;
      border-radius: 6px;
      font-size: 16px;
      border: none;
      background: #007bff;
      color: white;
    }
    input {
      padding: 10px;
      margin: 5px;
      width: 80%;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    #bottomNav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #fff;
      display: flex;
      justify-content: space-around;
      padding: 10px;
      border-top: 1px solid #ccc;
    }
  </style>
</head>
<body>

<!-- LOGIN SECTION -->
<div id="loginSection" class="section">
  <h2>Login</h2>
  <input id="loginEmail" placeholder="Email"><br>
  <input id="loginPass" type="password" placeholder="Password"><br>
  <button onclick="loginUser()">Login</button>
  <p onclick="toggleRegister()">Don't have an account? Register</p>
</div>

<!-- REGISTER SECTION -->
<div id="registerSection" class="section hidden">
  <h2>Register</h2>
  <input id="regEmail" placeholder="Email"><br>
  <input id="regPass" type="password" placeholder="Password"><br>
  <input id="referralCode" placeholder="Referral Code (optional)"><br>
  <button onclick="registerUser()">Register</button>
  <p onclick="toggleRegister()">Already have an account? Login</p>
</div>
<!-- GAME SECTION -->
<div id="gameSection" class="section hidden">
  <h3>Welcome: <span id="userEmail"></span></h3>
  <p>User ID: <span id="userIdDisplay"></span></p>
  <p>Wallet: ₹<span id="wallet"></span></p>
  <div>
    <button onclick="showGame('wingoGame')">Wingo</button>
    <button onclick="showGame('parityGame')">Parity</button>
  </div>

  <div id="wingoGame">
    <h4>Wingo Game</h4>
    <p>Period: <span id="periodDisplay"></span> | Time Left: <span id="countdown"></span></p>
    <input id="betAmount" placeholder="Bet Amount"><br>
    <div id="numberButtons"></div>
  </div>

  <div id="parityGame" class="hidden">
    <h4>Parity Game</h4>
    <p>Period: <span id="parityPeriodDisplay"></span> | Time Left: <span id="parityCountdown"></span></p>
    <input id="parityBetAmount" placeholder="Bet Amount"><br>
    <div id="parityNumbers"></div>
  </div>
</div>

<!-- WALLET SECTION -->
<div id="walletSection" class="section hidden">
  <h3>Wallet</h3>
  <p>Balance: ₹<span id="wallet2"></span></p>
  <input id="depositAmount" placeholder="Deposit Amount">
  <button onclick="deposit()">Deposit</button><br>
  <input id="withdrawAmount" placeholder="Withdraw Amount">
  <button onclick="withdraw()">Withdraw</button>
</div>

<!-- PROMOTION SECTION -->
<div id="promotionSection" class="section hidden">
  <h3>Referral</h3>
  <p>Your Code: <span id="myReferralCode"></span></p>
  <p>Link: <span id="referralLinkText"></span></p>
  <img id="refQr" src="" alt="QR Code" style="width: 150px;">
  <button onclick="shareReferral()">Copy Link</button>
</div>

<!-- BOTTOM NAVIGATION -->
<div id="bottomNav" class="hidden">
  <button onclick="switchSection('game')">Game</button>
  <button onclick="switchSection('wallet')">Wallet</button>
  <button onclick="switchSection('promotion')">Promotion</button>
  <button onclick="logoutUser()">Logout</button>
</div>
<!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-database-compat.js"></script>

<script>
  // Replace with your Firebase config
  const firebaseConfig = {
  apiKey: "AIzaSyBe5kGOwYS3FsF_9_q1pjxaWrF1glUe87c",
  authDomain: "wingologin.firebaseapp.com",
  databaseURL: "https://wingologin-default-rtdb.firebaseio.com",
  projectId: "wingologin",
  storageBucket: "wingologin.firebasestorage.app",
  messagingSenderId: "605536859710",
  appId: "1:605536859710:web:ed9495775c8f8dd6a8836f",
  measurementId: "G-FLDY936H9P"
};

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();
  let currentUser = null;

  function toggleRegister() {
    document.getElementById("loginSection").classList.toggle("hidden");
    document.getElementById("registerSection").classList.toggle("hidden");
  }

  function switchSection(section) {
    ["game", "wallet", "promotion"].forEach(id => {
      document.getElementById(id + "Section").classList.add("hidden");
    });
    document.getElementById(section + "Section").classList.remove("hidden");
  }

  function showGame(game) {
    document.getElementById("wingoGame").classList.add("hidden");
    document.getElementById("parityGame").classList.add("hidden");
    document.getElementById(game).classList.remove("hidden");
  }

  function registerUser() {
    const email = document.getElementById("regEmail").value;
    const password = document.getElementById("regPass").value;
    const referral = document.getElementById("referralCode").value;

    auth.createUserWithEmailAndPassword(email, password).then(userCred => {
      const uid = userCred.user.uid;
      db.ref("users/" + uid).set({
        email: email,
        wallet: 100,
        referralCode: uid.slice(0, 6),
        referredBy: referral || ""
      });
    }).catch(alert);
  }

  function loginUser() {
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPass").value;
    auth.signInWithEmailAndPassword(email, password).catch(alert);
  }

  function logoutUser() {
    auth.signOut();
  }

  auth.onAuthStateChanged(user => {
    if (user) {
      currentUser = user;
      const uid = user.uid;
      db.ref("users/" + uid).once("value").then(snapshot => {
        const data = snapshot.val();
        document.getElementById("userEmail").innerText = data.email;
        document.getElementById("userIdDisplay").innerText = uid;
        document.getElementById("wallet").innerText = data.wallet || 0;
        document.getElementById("wallet2").innerText = data.wallet || 0;
        document.getElementById("myReferralCode").innerText = data.referralCode;
        const refLink = location.origin + location.pathname + "?ref=" + data.referralCode;
        document.getElementById("referralLinkText").innerText = refLink;
        document.getElementById("refQr").src = "https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=" + encodeURIComponent(refLink);
      });
      document.getElementById("loginSection").classList.add("hidden");
      document.getElementById("registerSection").classList.add("hidden");
      document.getElementById("gameSection").classList.remove("hidden");
      document.getElementById("bottomNav").classList.remove("hidden");
    } else {
      currentUser = null;
      document.getElementById("gameSection").classList.add("hidden");
      document.getElementById("walletSection").classList.add("hidden");
      document.getElementById("promotionSection").classList.add("hidden");
      document.getElementById("bottomNav").classList.add("hidden");
      document.getElementById("loginSection").classList.remove("hidden");
    }
  });

  function deposit() {
    const amt = parseInt(document.getElementById("depositAmount").value);
    if (!currentUser || isNaN(amt)) return;
    const uid = currentUser.uid;
    const ref = db.ref("users/" + uid + "/wallet");
    ref.transaction(w => (w || 0) + amt);
  }

  function withdraw() {
    const amt = parseInt(document.getElementById("withdrawAmount").value);
    if (!currentUser || isNaN(amt)) return;
    const uid = currentUser.uid;
    const ref = db.ref("users/" + uid + "/wallet");
    ref.transaction(w => (w || 0) >= amt ? w - amt : w);
  }

  function shareReferral() {
    const text = document.getElementById("referralLinkText").innerText;
    navigator.clipboard.writeText(text);
    alert("Referral link copied!");
  }

  function createGameButtons() {
    for (let i = 0; i <= 9; i++) {
      const btn = document.createElement("button");
      btn.innerText = i;
      btn.onclick = () => placeBet(i, "wingo");
      document.getElementById("numberButtons").appendChild(btn);

      const pbtn = document.createElement("button");
      pbtn.innerText = i;
      pbtn.onclick = () => placeBet(i, "parity");
      document.getElementById("parityNumbers").appendChild(pbtn);
    }
  }

  function placeBet(number, game) {
    const amountInput = game === "wingo" ? "betAmount" : "parityBetAmount";
    const periodDisplay = game === "wingo" ? currentPeriod : currentPeriod;
    const amount = parseInt(document.getElementById(amountInput).value);
    if (!currentUser || isNaN(amount)) return;

    const uid = currentUser.uid;
    const path = `bets/${game}/${periodDisplay}/${uid}`;
    db.ref(path).push({ number: number, amount: amount });
    db.ref("users/" + uid + "/wallet").transaction(w => (w || 0) >= amount ? w - amount : w);
    alert("Bet placed on number " + number);
  }

  let currentPeriod = 0;
  let timer = 60;

  function startTimer() {
    setInterval(() => {
      timer--;
      if (timer <= 0) {
        currentPeriod++;
        timer = 60;
        calculateResults("wingo");
        calculateResults("parity");
      }
      document.getElementById("countdown").innerText = timer + "s";
      document.getElementById("parityCountdown").innerText = timer + "s";
      document.getElementById("periodDisplay").innerText = currentPeriod;
      document.getElementById("parityPeriodDisplay").innerText = currentPeriod;
    }, 1000);
  }

  function calculateResults(game) {
    db.ref(`bets/${game}/${currentPeriod - 1}`).once("value", snapshot => {
      const allBets = snapshot.val();
      if (!allBets) return;

      const totals = Array(10).fill(0);
      for (let uid in allBets) {
        for (let key in allBets[uid]) {
          const bet = allBets[uid][key];
          totals[bet.number] += bet.amount;
        }
      }
      const winningNumber = totals.indexOf(Math.max(...totals));
      for (let uid in allBets) {
        for (let key in allBets[uid]) {
          const bet = allBets[uid][key];
          if (bet.number == winningNumber) {
            const winAmount = bet.amount * 2;
            db.ref("users/" + uid + "/wallet").transaction(w => (w || 0) + winAmount);
          }
        }
      }
    });
  }

  createGameButtons();
  startTimer();
</script>

</body>
</html>
