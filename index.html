<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Investment Platform</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
  header { background: #1976d2; color: white; padding: 10px; text-align: center; font-size: 20px; }
  .content { padding: 15px; }
  .hidden { display: none; }
  .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; border-top: 1px solid #ccc; display: flex; }
  .bottom-nav button { flex: 1; padding: 10px; border: none; background: none; font-size: 14px; }
  .bottom-nav button.active { background: #1976d2; color: white; }
  .submenu { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 15px; }
  .submenu div { background: white; border-radius: 8px; padding: 10px; text-align: center; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
  .submenu div img { width: 40px; height: 40px; margin-bottom: 5px; }
</style>
</head>
<body>

<header id="header-title">Login</header>

<!-- Login/Register Page -->
<div id="login-page" class="content">
  <h2>Login</h2>
  <input type="email" id="login-email" placeholder="Email"><br><br>
  <input type="password" id="login-password" placeholder="Password"><br><br>
  <button onclick="loginUser()">Login</button>
  <p>Don't have an account? <a href="#" onclick="showRegister()">Register</a></p>
</div>

<div id="register-page" class="content hidden">
  <h2>Register</h2>
  <input type="email" id="register-email" placeholder="Email"><br><br>
  <input type="password" id="register-password" placeholder="Password"><br><br>
  <button onclick="registerUser()">Register</button>
  <p>Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
</div>

<!-- Home Page -->
<div id="home-page" class="content hidden">
  <h2>Welcome to Investment Platform</h2>
  <p>Latest updates will show here.</p>
</div>

<!-- Account Page -->
<div id="account-page" class="content hidden">
  <h2>My Account</h2>
  <p><strong>User ID:</strong> <span id="user-id-display"></span></p>
  <p><strong>Wallet Balance:</strong> ₹<span id="wallet-balance">0</span></p>
  <div class="submenu">
    <div onclick="openPage('team')"><img src="team.png"><p>Team</p></div>
    <div onclick="openPage('myProduct')"><img src="product.png"><p>My Product</p></div>
    <div onclick="openPage('bankCard')"><img src="bank.png"><p>Bank Card</p></div>
    <div onclick="openPage('transaction')"><img src="transaction.png"><p>Transaction</p></div>
    <div onclick="openPage('customerService')"><img src="support.png"><p>Customer Service</p></div>
    <div onclick="openPage('resetPassword')"><img src="reset.png"><p>Reset Password</p></div>
  </div>
  <br>
  <button onclick="logoutUser()">Logout</button>
</div>

<!-- Submenu Pages -->
<div id="team-page" class="content hidden"><h2>Team</h2><p>Your team details here.</p></div>
<div id="myProduct-page" class="content hidden"><h2>My Product</h2><p>Your products here.</p></div>
<div id="bankCard-page" class="content hidden">
  <h2>Bind Bank Card</h2>
  <input type="text" id="bank-name" placeholder="Bank Name"><br><br>
  <input type="text" id="ifsc-code" placeholder="IFSC Code"><br><br>
  <input type="text" id="account-number" placeholder="Account Number"><br><br>
  <input type="text" id="account-holder" placeholder="Account Holder Name"><br><br>
  <button onclick="saveBankDetails()">Save</button>
</div>
<div id="transaction-page" class="content hidden"><h2>Transactions</h2><p>Your transaction history.</p></div>
<div id="customerService-page" class="content hidden"><h2>Customer Service</h2><p>Contact us at support@example.com</p></div>
<div id="resetPassword-page" class="content hidden">
  <h2>Reset Password</h2>
  <input type="password" id="new-password" placeholder="New Password"><br><br>
  <button onclick="resetPassword()">Update Password</button>
</div>

<!-- Bottom Navigation -->
<div class="bottom-nav">
  <button id="nav-home" onclick="showSection('home-page')">Home</button>
  <button id="nav-invest" onclick="alert('Invest Page Coming Soon')">Invest</button>
  <button id="nav-blog" onclick="alert('Blog Page Coming Soon')">Blog</button>
  <button id="nav-notice" onclick="alert('Notice Page Coming Soon')">Notice</button>
  <button id="nav-account" onclick="showSection('account-page')">Account</button>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDvF1KrDDRZJucp-78dbvmQ34Oi3j17Rrk",
    authDomain: "investment-website-deml.firebaseapp.com",
    projectId: "investment-website-deml",
    storageBucket: "investment-website-deml.firebasestorage.app",
    messagingSenderId: "814451995593",
    appId: "1:814451995593:web:55e3280d9cb43200f1ee18",
    measurementId: "G-8FKZE5NNSX"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
</script>
<style>
  /* --- Slide-in panel effect for submenu pages --- */
  .content { position: relative; overflow-x: hidden; }
  .panel { display:none; position:fixed; top:60px; left:0; right:0; bottom:60px; background:#f5f5f5; padding:15px; z-index:10; }
  .panel.show { display:block; animation: slideIn .25s ease-out; }
  @keyframes slideIn { from { transform: translateX(100%);} to { transform: translateX(0);} }

  /* Hide bottom nav on auth pages */
  .bottom-nav.hidden { display:none; }
</style>

<script>
/* =========================
   Simple router helpers
========================= */
const headerTitle = document.getElementById('header-title');
const bottomNav = document.querySelector('.bottom-nav');

// Top-level sections from Part 1
const PAGES = ['login-page','register-page','home-page','account-page'];
// Submenu pages (panels)
const SUBPAGES = ['team-page','myProduct-page','bankCard-page','transaction-page','customerService-page','resetPassword-page'];

function setHeader(text){ headerTitle.textContent = text; }

function showSection(id){
  // hide all main content sections
  PAGES.forEach(pid => document.getElementById(pid).classList.add('hidden'));
  // hide all subpages (if any open)
  SUBPAGES.forEach(pid => closePanel(pid));
  document.getElementById(id).classList.remove('hidden');

  // header + nav title mapping
  const map = {
    'login-page':'Login',
    'register-page':'Register',
    'home-page':'Home',
    'account-page':'Account'
  };
  setHeader(map[id] || 'App');

  // bottom nav visible only when logged-in screens
  if (id === 'login-page' || id === 'register-page') {
    bottomNav.classList.add('hidden');
  } else {
    bottomNav.classList.remove('hidden');
  }

  // highlight nav
  document.querySelectorAll('.bottom-nav button').forEach(b=>b.classList.remove('active'));
  if (id==='home-page') document.getElementById('nav-home').classList.add('active');
  if (id==='account-page') document.getElementById('nav-account').classList.add('active');
}

function openPage(key){
  // key matches prefix of element id used in Part 1
  const id = key + '-page';
  // close any open panels, then open requested
  SUBPAGES.forEach(pid => closePanel(pid));
  const el = document.getElementById(id);
  if (el){ el.classList.add('panel','show'); setHeader(el.querySelector('h2')?.textContent || ''); }
}
function closePanel(id){
  const el = document.getElementById(id);
  if (!el) return;
  el.classList.remove('show');
  el.classList.add('hidden'); // keep hidden when not shown
}

/* =========================
   Auth + Firestore profile
========================= */
let currentUser = null;

auth.onAuthStateChanged(async (user)=>{
  if (!user) {
    // Not logged in ⇒ go to Login
    showSection('login-page');
    return;
  }

  currentUser = user;
  // Ensure user document with 6-digit userId for new/old users
  const docRef = db.collection('users').doc(user.uid);
  const snap = await docRef.get();
  if (!snap.exists) {
    await docRef.set({ 
      email: user.email || null,
      userId: gen6(),
      balance: 0,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
  } else if (!snap.data().userId) {
    await docRef.update({ userId: gen6() });
  }

  // Start UI
  loadProfile();
  showSection('home-page');
});

function gen6(){ return Math.floor(100000 + Math.random()*900000).toString(); }

async function loginUser(){
  const email = (document.getElementById('login-email').value || '').trim();
  const pass  = (document.getElementById('login-password').value || '').trim();
  if (!email || !pass) return alert('Enter email and password');
  try {
    await auth.signInWithEmailAndPassword(email, pass);
  } catch(err){
    if (err.code === 'auth/user-not-found') {
      alert('No user found. Please register.');
      showRegister();
    } else {
      alert(err.message);
    }
  }
}
async function registerUser(){
  const email = (document.getElementById('register-email').value || '').trim();
  const pass  = (document.getElementById('register-password').value || '').trim();
  if (!email || !pass) return alert('Enter email and password');
  try {
    const cred = await auth.createUserWithEmailAndPassword(email, pass);
    // Create profile with 6-digit id
    await db.collection('users').doc(cred.user.uid).set({
      email, userId: gen6(), balance: 0, createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    alert('Registered! You can now log in.');
    showLogin();
  } catch(err){ alert(err.message); }
}
function logoutUser(){
  auth.signOut().then(()=>{
    currentUser = null;
    // Clear UI & go to login
    showSection('login-page');
  });
}
function showRegister(){ showSection('register-page'); }
function showLogin(){ showSection('login-page'); }

/* =========================
   Wallet + Profile binding
========================= */
function loadProfile(){
  if (!currentUser) return;
  db.collection('users').doc(currentUser.uid).onSnapshot(doc=>{
    const d = doc.data() || {};
    document.getElementById('user-id-display').textContent = d.userId || '------';
    document.getElementById('wallet-balance').textContent = Number(d.balance||0).toFixed(2);
  });
}

/* =========================
   Bank Card save
========================= */
async function saveBankDetails(){
  if (!currentUser) return alert('Please login first');
  const payload = {
    bankName: (document.getElementById('bank-name').value||'').trim(),
    ifsc: (document.getElementById('ifsc-code').value||'').trim(),
    accountNumber: (document.getElementById('account-number').value||'').trim(),
    accountHolder: (document.getElementById('account-holder').value||'').trim(),
    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
  };
  if (!payload.bankName || !payload.ifsc || !payload.accountNumber || !payload.accountHolder) {
    return alert('Please fill all bank fields');
  }
  await db.collection('users').doc(currentUser.uid).update({ bankCard: payload });
  alert('Bank details saved');
  // Return to Account main
  closePanel('bankCard-page'); showSection('account-page'); setHeader('Account');
}

/* =========================
   Reset password
========================= */
async function resetPassword(){
  if (!currentUser) return alert('Please login first');
  const newPass = (document.getElementById('new-password').value||'').trim();
  if (!newPass) return alert('Enter a new password');
  try {
    await currentUser.updatePassword(newPass);
    alert('Password updated');
    document.getElementById('new-password').value='';
    closePanel('resetPassword-page'); showSection('account-page'); setHeader('Account');
  } catch(err){
    // If requires recent login, fallback to email reset
    try {
      const email = currentUser.email;
      if (!email) throw new Error('No email on account');
      await auth.sendPasswordResetEmail(email);
      alert('Session too old. Password reset email sent to ' + email);
    } catch(e2){
      alert(err.message);
    }
  }
}

/* =========================
   Transactions (placeholder)
========================= */
function openTransaction(){
  // If you later store txns in Firestore, load & render here
  openPage('transaction');
}

/* =========================
   Hook up Account submenu taps
========================= */
function openTeam(){ openPage('team'); }
function openMyProduct(){ openPage('myProduct'); }
function openBankCard(){ openPage('bankCard'); }
function openCustomerService(){ openPage('customerService'); }

/* Default route if someone clicks bottom nav before auth resolves */
if (!auth.currentUser) showSection('login-page');
</script>
</body>
</html>
